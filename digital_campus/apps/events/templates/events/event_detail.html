{% extends "digital_campus/base.html" %}
{% load tz %}
{% block content %}
{% load static %}

<!-- Event Detail CSS -->
<link rel="stylesheet" href="{% static 'digital_campus/css/event_detail.css' %}">

<!-- Main Content -->
<article class="container mt-4 text-light">
  <!-- Title & Badge -->
  <div class="d-flex justify-content-between align-items-start mb-3">
    <h1 class="text-white">{{ event.title }}</h1>
  
    {% if request.user.is_authenticated and event.created_by != request.user %}
      <form method="post" action="{% url 'events:attend-event' event.pk %}">
        {% csrf_token %}

        {% if attendance_status == "attending" %}

          <button type="submit" class="btn btn-success default-btn btn-lg">
            <i class="bi bi-check-circle me-1"></i> Attending
          </button>

        {% elif attendance_status == "requested" %}

        <button type="submit" class="btn btn-primary default-btn btn-lg">
          <i class="bi bi-hourglass-split me-1"></i>  Requested
        </button>

        {% else %}
        
          <button type="submit" class="btn btn-outline-primary btn-lg">
            <i class="bi bi-person-plus-fill"></i> Attend
          </button>
        {% endif %}

      </form>
    {% endif %}

  </div>

  {% if object.is_featured %}
    <span class="badge bg-warning text-dark mb-4">Featured</span>
  {% endif %}

  <!-- Description -->
  <p class="fs-5">{{ object.description|linebreaks }}</p>

  <!-- Host Info -->
  <p>
    <strong>Hosted By:</strong>
    {% if object.club %}
      <a href="{% url 'clubs:club-detail' object.club.slug %}">{{ object.club.name }}</a>
    {% elif object.created_by %}
      <a href="{% url 'common:user-posts' object.created_by.username %}">{{ object.created_by }}</a>
    {% endif %}
  </p>
  

  <!-- Tag List -->
  {% if object.requirements.all %}
    <p>
      <strong>Tags:</strong>
      {% for tag in object.requirements.all %}
        <span class="badge bg-secondary">{{ tag }}</span>
      {% endfor %}
    </p>
  {% endif %}

  {% if object.duration %}
    <p><strong>Duration:</strong> {{ object.duration }}</p>
  {% endif %}

  <!-- 2×2 Info Grid -->
  <div class="info-grid">

    <!-- Date -->
    <div class="info-cell">
      <i class="bi bi-calendar fs-3"></i>
      <div>
        <h6>Date</h6>
        <p>{{ object.starts_at|date:"l, F j, Y" }}</p>
      </div>
    </div>

    <!-- Time -->
    <div class="info-cell">
      <i class="bi bi-clock fs-3"></i>
      <div>
        <h6>Time</h6>
        <p>
          {{ object.starts_at|date:"g:i A" }}
          {% if object.ends_at %}–{{ object.ends_at|date:"g:i A" }}{% endif %}
        </p>
      </div>
    </div>

    <!-- Location -->
    <div class="info-cell">
      <i class="bi bi-geo-alt-fill fs-3"></i>
      <div>
        <h6>Location</h6>
        <p>{{ object.location }}</p>
      </div>
    </div>

    <!-- Organizer/Host -->
    <div class="info-cell">
      <i class="bi bi-people-fill fs-3"></i>
      <div>
        <h6>{% if object.club %}Organizer{% else %}Host{% endif %}</h6>
        <p>{% if object.club %}{{ object.club.name }}{% else %}{{ object.created_by.username }}{% endif %}</p>
      </div>
    </div>
  </div>

  <!-- Media Attachments -->
  {% if object.attachments.exists %}
    <div class="row row-cols-1 row-cols-md-2 g-3 mt-5">
      {% for att in object.attachments.all %}
        <div class="col">
          {% if att.media_type == "image" %}
            <img src="{{ att.file.url }}" class="img-fluid rounded" alt="Event image">
          {% else %}
            <video src="{{ att.file.url }}" class="w-100 rounded" controls aria-label="Event video"></video>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <!-- Admin-only Featured Toggle -->
  {% if user.is_staff %}
    <a href="{% url 'events:event-toggle-feature' object.pk %}"
       class="btn btn-sm btn-outline-light mt-4">
      {% if object.is_featured %}Remove “Featured”{% else %}Mark as Featured{% endif %}
    </a>
  {% endif %}

</article>
{% endblock %}
