{% extends "digital_campus/base.html" %}
{% load static %}
{% block content %}
<article class="media content-section">
  <!-- Avatar with fallback -->
  {% if object.author.profile.image %}
    <img class="rounded-circle article-img" src="{{ object.author.profile.image.url }}" alt="{{ object.author.username }}â€™s avatar">
  {% else %}
    <img class="rounded-circle article-img" src="{% static 'digital_campus/images/default-user.png' %}" alt="Default avatar">
  {% endif %}

  <div class="media-body">
    <div class="article-metadata">
      <a href="{% url 'common:user-posts' object.author.username %}">
        {{ object.author }}
      </a>
      <small class="text-muted">
        {{ object.date_posted|date:"F d, Y" }}
      </small>
    </div>

    <h2 class="article-title">{{ object.title }}</h2>

    <div class="collapsible-content collapsed">
      {% for attach in object.attachments.all %}
        {% if attach.media_type == 'image' %}
          <div class="post-image mb-2">
            <img src="{{ attach.file.url }}" alt="" class="img-fluid rounded">
          </div>
        {% else %}
          <div class="post-video mb-2">
            <video controls muted playsinline style="max-width:100%; max-height:80vh">
              <source src="{{ attach.file.url }}" type="video/mp4">
            </video>
          </div>
        {% endif %}
      {% endfor %}

      <p class="article-content">{{ object.content|safe }}</p>
    </div>

    <div class="expand-toggle">
      <i class="bi bi-chevron-down"></i>
    </div>

    {% if object.author == user %}
    <div class="mt-3">
      <a class="btn btn-secondary btn-sm"
         href="{% url 'posts:post-update' object.id %}">Update</a>
      <a class="btn btn-danger btn-sm"
         href="{% url 'posts:post-delete' object.id %}">Delete</a>
    </div>
    {% endif %}
  </div>
</article>
{% endblock %}
