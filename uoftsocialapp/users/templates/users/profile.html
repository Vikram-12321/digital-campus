{% extends "uoftsocial/base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}
<div class="container mt-4">

  <!-- Basic Profile Display -->
  <div class="card mb-4">
    <div class="card-body d-flex align-items-center">
      <img 
        class="rounded-circle mr-3" 
        src="{{ request.user.profile.image.url }}" 
        alt="{{ request.user.username }}'s picture"
        style="width: 100px; height: 100px; object-fit: cover;"
      >
      <div>
        <h3 class="card-title mb-1">{{ request.user.username }}</h3>
        <p class="text-muted mb-2">{{ request.user.email }}</p>
        <p>{{ request.user.profile.bio }}</p>

        <!-- Button to open the modal -->
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#editProfileModal">
          Edit Profile
        </button>
      </div>
    </div>
  </div>

</div> <!-- .container -->


<!-- Bootstrap Modal for Editing Profile -->
<div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">

    <div class="modal-content">
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <div class="modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">Edit Your Profile</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span>&times;</span>
          </button>
        </div>

        <div class="modal-body">
          <!-- Include the form media so DAL has the JS/CSS for Select2 -->
          {{ u_form.media }}
          {{ p_form.media }}

          <!-- User fields (username, email) -->
          <fieldset class="form-group">
            <legend>User Info</legend>
            {{ u_form|crispy }}
          </fieldset>

          <!-- Profile fields (image, bio, is_private, courses, group_channels) -->
          <fieldset class="form-group">
            <legend>Profile Info</legend>
            {{ p_form|crispy }}
          </fieldset>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-success">Save Changes</button>
        </div>

      </form>
    </div>

  </div>
</div>

<!-- SCRIPTS (in correct order) -->
<!-- 1) jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- 2) Select2 (needed by django-autocomplete-light) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.full.min.js"></script>
<!-- 3) Bootstrap bundle -->
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>

{% endblock content %}
